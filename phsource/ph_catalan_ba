
//====================================================
//  Catalan balearic - based on Catalan (and Spanish and Base2)
//====================================================


// plosives (oclusives)
// ====================

// mirar https://giec.iec.cat/textgramatica/codi/4.2.1

// vowels
//=====================================================

phoneme e
  vwl starttype #e endtype #e
  length 170
  
  IF thisPh(isUnstressed) THEN
    IF thisPh(isWordEnd) AND NOT thisPh(isFirstVowel) THEN
        IF prevVowel(O) OR prevVowel(o) THEN
            ChangePhoneme(o)
        ELSE
            ChangePhoneme(@)
        ENDIF
    ELSE
        ChangePhoneme(@)
    
    ENDIF
  ENDIF
  FMT(vowel/e)
endphoneme

phoneme O
  vwl starttype #o endtype #o
  length 170
  IF thisPh(isWordEnd) THEN
    IF nextPh(o) OR nextPh(O) THEN
       ipa NULL
    ELSE
        ChangeIfUnstressed(o)
    ENDIF
  ELIF thisPh(isUnstressed) THEN
    ChangePhoneme(o)
  ENDIF
  FMT(vowel/oo)
endphoneme

phoneme o
  vwl starttype #o endtype #o
  length 170
  IF thisPh(isUnstressed) THEN
    ChangePhoneme(u)
  ENDIF
  
  IF thisPh(isWordEnd) THEN
    IF nextPh(o) OR nextPh(O) THEN
       ipa NULL
    ENDIF
  ENDIF
  FMT(vowel/o)
endphoneme

// En alguns parlars mallorquins i occidentals, és habitual el tancament de la o àtona en u quan es troba en síl·laba àtona seguida d’una síl·laba tònica o pretònica amb [i] i, més esporàdicament, seguida d’una síl·laba tònica amb [u] o, només en parlars mallorquins, d’una síl·laba pretònica amb [u]: conill, cosí, coixí, tossir, cossiol, comú, consumirà [u]. També és habitual el tancament de la o àtona en u quan la o va precedida d’una consonant palatoalveolar, com en Josep, Joan o joventut [u].


phoneme @    //  Schwa, e.g. alph**a**
  vwl   starttype #@  endtype #@
  length 140
  FMT(vowel/@)
endphoneme


phoneme v
  vcd lbd frc
  voicingswitch f
  lengthmod 6
  Vowelin  f1=0  f2=1000 -300 -200  f3=-300 100
  Vowelout f1=0  f2=1000 -500 -300  f3=-300 60  len=50

  IF KlattSynth THEN
    Vowelout f1=1  f2=1000 -500 -300  f3=-300 60  len=50 brk
    IF nextPh(isPause2) THEN
      FMT(klatt/v_) addWav(vocw/v)
    ENDIF
    FMT(klatt/v) addWav(vocw/v, 150)
  ENDIF

  IF nextPh(isPause2) THEN
    FMT(voc/v_) addWav(vocw/v)
  ENDIF
  IF thisPh(isWordStart) AND nextPhW(isLiquid) THEN
    length 70
  ENDIF
  FMT(voc/v) addWav(vocw/v)
endphoneme

phoneme l^    // palatal l, e.g. Italian **g**li
  liquid
  ipa ʎ
  lengthmod 7
  Vowelout len=60 lenadd rate
  length 100

  NextVowelStarts
    VowelStart(l^/j2@)
    VowelStart(l^/j2a)
    VowelStart(l^/j2e)
    VowelStart(l^/j2i)
    VowelStart(l^/j2o)
    VowelStart(l^/j2u)
  EndSwitch

  IF prevPh(isPause) THEN
    FMT(l^/_l^)
  ELIF prevPh(isVowel) THEN
    IF thisPh(isWordEnd) THEN
        ChangePhoneme(j)
    ELIF nextPh(s) AND nextPh(isWordEnd) THEN
        ChangePhoneme(j)
  
  
    ELIF nextPh(isVowel) THEN
        IF nextPh(isStressed) THEN
            IF nextPh(i) OR nextPh(e) THEN
                ipa NULL
            ELSE
                ChangePhoneme(j)
            ENDIF
        ELIF prevPh(isStressed) THEN
            IF prevPh(i) OR prevPh(e) THEN
                ipa NULL
            ELSE
                ChangePhoneme(j)
            ENDIF
        ELSE
            ChangePhoneme(j)
        ENDIF
    ENDIF
  ENDIF

  FMT(l^/l^)
endphoneme
